\chapter{Heterogeneous Fog Device Generator Implementation}
\label{appendix:device-generator}

I implemented a device generator that creates a three-tier hierarchy with configurable resources. This implementation creates cloud, edge, and user devices with appropriate hierarchy and resource heterogeneity:

\begin{verbatim}
private static void createFogDevices(int brokerId, Map<String, Application> applicationsPerType,
                                     int numberOfEdge, Map<String, Integer> usersPerType, 
                                     SimulationConfig simulationConfig) {
    // Create cloud device at the top of the hierarchy
    SPPFogDevice cloud = createFogDevice("cloud", 44800, -1, 40000, 100, 10000, 0.01, 
                                         16 * 103, 16 * 83.25, SPPFogDevice.CLOUD);
    cloud.setParentId(References.NOT_SET);
    cloud.setLevel(0);
    
    // Set the placement process interval from the simulation config
    cloud.setPlacementProcessInterval(simulationConfig.getPlacementProcessInterval());
    System.out.println("Cloud device using placement process interval: " + cloud.getPlacementProcessInterval());
    
    fogDevices.add(cloud);
    Random random = new Random(simulationConfig.getExperimentSeed());

    // Create gateway devices with heterogeneous resources
    for (int i = 0; i < numberOfEdge; i++) {
        // Random MIPS between 1000-4000, random RAM between 1000-32000 MB
        SPPFogDevice gateway = createFogDevice(
                "gateway_" + i,
                random.nextInt(3001) + 1000,  // CPU: uniformly distributed between 1000-4000 MIPS
                -1,                           // Latency set by Location Manager
                random.nextInt(31001) + 1000, // RAM: uniformly distributed between 1000-32000 MB
                10000,                        // Uplink bandwidth
                10000,                        // Downlink bandwidth
                0.0,                          // Rate per MIPS
                107.339,                      // Busy power
                83.4333,                      // Idle power
                SPPFogDevice.FCN
        );
        gateway.setParentId(cloud.getId());
        // Let latency be set by LocationManager in connectWithLatencies
        gateway.setLevel(1);
        fogDevices.add(gateway);
    }

    // Calculate total number of users for statistics
    int numberOfUser = usersPerType.values().stream().mapToInt(Integer::intValue).sum();

    // Create user devices for each type
    for (String userType : usersPerType.keySet()) {
        // Validate user type - fail fast if type is unknown
        if (!(Objects.equals(userType, SPPFogDevice.GENERIC_USER) ||
            Objects.equals(userType, SPPFogDevice.AMBULANCE_USER) ||
            Objects.equals(userType, SPPFogDevice.OPERA_USER) ||
            Objects.equals(userType, SPPFogDevice.IMMOBILE_USER))) {
            throw new NullPointerException("Invalid User Type: " + userType);
        }

        int numUsersOfThisType = usersPerType.get(userType);
        
        // For new configuration (applicationPool), create users without specific applications
        if (applicationsPerType == null) {
            for (int i = 0; i < numUsersOfThisType; i++) {
                FogDevice mobile = addUser(userType, userType + "_" + i, brokerId, null, References.NOT_SET);
                mobile.setLevel(2);
                fogDevices.add(mobile);
            }
        }
        // For legacy configuration with applications per user type
        else {
            Application appForThisType = applicationsPerType.get(userType);
            for (int i = 0; i < numUsersOfThisType; i++) {
                // Use the specific application for this user type
                FogDevice mobile = addUser(userType, userType + "_" + i, brokerId, appForThisType, References.NOT_SET);
                mobile.setLevel(2);
                fogDevices.add(mobile);
            }
        }
    }
    
    System.out.println("Created topology with " + (numberOfEdge + 1) + " edge+cloud servers and " + 
                       numberOfUser + " user devices");
}

private static FogDevice addUser(String userType, String name, int brokerId, Application app, int parentId) {
    // Create mobile device with appropriate type
    SPPFogDevice mobile = createFogDevice(name, 200, -1, 200, 10000, 270, 0, 87.53, 82.44, userType);
    mobile.setParentId(parentId);
    
    if (app != null) {
        // Create sensor and actuator with specific application
        Sensor mobileSensor = new PassiveSensor("s-" + name, "SENSOR", brokerId, app.getAppId(), 
                              new DeterministicDistribution(SENSOR_TRANSMISSION_TIME));
        mobileSensor.setApp(app);
        sensors.add(mobileSensor);
        
        Actuator mobileDisplay = new Actuator("a-" + name, brokerId, app.getAppId(), "DISPLAY");
        actuators.add(mobileDisplay);

        mobileSensor.setGatewayDeviceId(mobile.getId());
        mobileSensor.setLatency(6.0);  // latency of connection between sensors and the parent device

        mobileDisplay.setGatewayDeviceId(mobile.getId());
        mobileDisplay.setLatency(1.0);  // latency of connection between display actuator and the parent device
        mobileDisplay.setApp(app);
    } else {
        // If no app, create sensor and actuator without specific application
        // The application will be randomly assigned during placement request generation
        Sensor mobileSensor = new PassiveSensor("s-" + name, "SENSOR", brokerId, null, 
                              new DeterministicDistribution(SENSOR_TRANSMISSION_TIME));
        sensors.add(mobileSensor);
        
        Actuator mobileDisplay = new Actuator("a-" + name, brokerId, null, "DISPLAY");
        actuators.add(mobileDisplay);

        mobileSensor.setGatewayDeviceId(mobile.getId());
        mobileSensor.setLatency(6.0);

        mobileDisplay.setGatewayDeviceId(mobile.getId());
        mobileDisplay.setLatency(1.0);
    }

    return mobile;
}
\end{verbatim}

This implementation creates a three-tier hierarchy of devices with heterogeneous resource capabilities. The cloud server has high computing capacity, edge servers have resources drawn from uniform distributions, and user devices have limited resources. Each user device is equipped with a sensor and an actuator to enable the simulation of complete application workflows. 

The implementation supports both the legacy model where user types are associated with specific applications, and a new model where applications are assigned dynamically during placement request generation. This flexibility enables a wider range of simulation scenarios without code modifications. 